C51 COMPILER V9.54   MAIN                                                                  08/13/2019 13:46:48 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.l
                    -st) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "reg51.h"
   2          #include "string.h"
   3          #define GPRMC_TERM "$GPRMC,"    //定义要解析的指令，因为这条指令包含定位和时间信息
   4          #define MAX_DATA 68
   5          typedef unsigned int u16;    //对数据类型进行声明定义
   6          typedef unsigned char u8;
   7          
   8          //ToDo:
   9          //    Define a struct to save data better, and use it better.
  10          /*
  11          struct rcvdata  {
  12              char position[];
  13              char
  14              char
  15              char
  16              char
  17          };
  18          */
  19          
  20          char receiveData[MAX_DATA];
  21          
  22          
  23          
  24          void UsartInit()
  25          {
  26   1          SCON=0X50;          //设置为工作方式1
  27   1          TMOD=0X20;          //设置计数器工作方式2
  28   1          PCON=0X80;          //波特率加倍
  29   1          TH1=0XF3;           //计数器初始值设置，注意波特率是4800的
  30   1          TL1=0XF3;
  31   1          ES=1;               //打开接收中断
  32   1          EA=1;               //打开总中断
  33   1          TR1=1;              //打开计数器
  34   1      }
  35          
  36          
  37          void main()
  38          {
  39   1          UsartInit();  //  串口初始化
  40   1          while(1);
  41   1      }
  42          
  43          void Usart() interrupt 4
  44          {
  45   1          u8 i;
  46   1          char identity[7] = GPRMC_TERM;
  47   1          
  48   1          for (i=0; i<MAX_DATA; i++){
  49   2              receiveData[i] = SBUF;
  50   2              RI = 0;
  51   2          }//内容全接收
  52   1      
  53   1          if (strncmp(identity, receiveData, 7) == 0){ //假如验证位正确
  54   2              while (1){
C51 COMPILER V9.54   MAIN                                                                  08/13/2019 13:46:48 PAGE 2   

  55   3                  i++;
  56   3                  if (receiveData[i] != '\n'){
  57   4                      SBUF = receiveData[i];
  58   4                      while(!TI);
  59   4                      TI=0;
  60   4                  }else{
  61   4                      break;
  62   4                  }
  63   3              }
  64   2          }
  65   1      }
  66          
  67          
  68          /*  GPS显示示例:
  69                  $GPRMC,115418.00,V,,,,,,,120819,,,N*76
  70                  $GPVTG,,,,,,,,,N*30
  71                  $GPGGA,115418.00,,,,,0,03,4.01,,,,,,*58
  72                  $GPGSA,A,1,13,24,21,,,,,,,,,,4.14,4.01,1.00*02
  73                  $GPGSV,1,1,03,13,09,052,26,21,61,261,27,24,73,099,34*43
  74                  $GPGLL,,,,,115418.00,V,N*42
  75          * */


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    170    ----
   CONSTANT SIZE    =      7    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     68       8
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
